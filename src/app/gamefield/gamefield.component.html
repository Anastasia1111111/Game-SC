<div class="game-field-header">
  <span>
    @if (gameService.buttonState.length) {
      {{ gameService.sizeForm.value.width }}x{{
        gameService.sizeForm.value.height
      }}
    }
  </span>
  <div>
    <button class="step-back" (click)="onStepBackClick()">STEP BACK</button>
    <button class="restart" (click)="dialog.showModal()">
      <span>RESTART</span>
    </button>
  </div>
</div>

@if (gameService.buttonState.length) {
  <app-board
    [buttonState]="gameService.buttonState"
    [historyMoves]="gameService.historyMoves"
    [knightPositions]="gameService.knightPositions"
    (restart)="onRestartClick()"
    (selectSellEmitter)="onSelectCell($event)"
    (loseDialog)="losePopUp()"
    (winnerDialog)="winnerPopUp()"
    [height]="gameService.sizeForm.value.height!"
    [width]="gameService.sizeForm.value.width!"
    [style.--columns]="gameService.sizeForm.value.width!"
    [style.--rows]="gameService.sizeForm.value.height!"
  >
  </app-board>
}

<dialog class="start-dialog" #startDialog open>
  <div>
    <header>
      <span>START GAME</span>
    </header>
    <div>
      <p class="choose">Choose the size of the playing field</p>
      <form [formGroup]="gameService.sizeForm">
        <label
          >Width <input type="text" placeholder="Width" formControlName="width"
        /></label>
        <label
          >Height
          <input type="text" placeholder="Height" formControlName="height"
        /></label>
        <button class="exit" type="submit" (click)="createArray()">
          <span>START</span>
        </button>
      </form>
    </div>
    <footer></footer>
  </div>
</dialog>

<dialog #dialog>
  <div>
    <header class="restart-button">
      <span>RESTART</span>
      <img (click)="dialog.close()" src="../../assets/close.svg" />
    </header>
    <div>
      <p class="question">Are you sure?</p>
      <div class="flex">
        <button class="confirm" (click)="dialog.close(); onRestartClick()">
          <span>YES</span>
        </button>
        <button class="cancel" (click)="dialog.close()"><span>NO</span></button>
      </div>
    </div>
    <footer></footer>
  </div>
</dialog>

<dialog #loseDialog>
  <div>
    <header>
      <span>SORRY!</span>
      <img
        class="cross"
        (click)="loseDialog.close()"
        src="../../assets/close.svg"
      />
    </header>
    <div>
      <img class="sad" src="../../assets/sad.svg" />
      <p class="message">You lose!</p>
      <button class="exit" (click)="loseDialog.close(); onRestartClick()">
        <span>TRY AGAIN</span>
      </button>
    </div>
    <footer></footer>
  </div>
</dialog>

<dialog #winnerDialog>
  <div>
    <header>
      <span>CONGRATS!</span>
      <img
        class="cross"
        (click)="winnerDialog.close()"
        src="../../assets/close.svg"
      />
    </header>
    <div>
      <img class="happy" src="../../assets/happy.svg" />
      <p class="message">You are WINNER!</p>
      <button class="exit" (click)="winnerDialog.close(); onRestartClick()">
        <span>RESTART</span>
      </button>
    </div>
    <footer></footer>
  </div>
</dialog>
